<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>GSI Tiles on OpenLayers 3</title>
<link rel="stylesheet" href="https://openlayers.org/en/v3.20.1/css/ol.css" type="text/css">
<script src="https://openlayers.org/en/v3.20.1/build/ol.js" type="text/javascript"></script>
<style>
  body {padding: 0; margin: 0}
  html, body, #map {height: 100%; width: 100%;}
</style>
</head>
<body onload="init_map()">
<div id="map"></div>
<script>
        var debug_flg = true;
        var gsi_layer;
        var gsj_layer;
        var osm_layer;
        var map;
        var view;
        var initZoom = 15; // ズームの初期値
        var MinZoom  = 6;   // ズームの最小値（最も広い範囲）
        var MaxZoom  = 17;  // ズームの最大値（最も狭い範囲）

        var lineVector = null;                             // vector layer variable
        var vectorSource = null;                           // variable for source
        var vectorFeature = null;                          // variable for feature
        var lineStrings = new ol.geom.MultiLineString([]); // line instance of the path
        var lineStrArray = new Array();                    // line data array as lineString format [[pt0,pt1],[pt1,pt2],[pt2,pt3],....]
        var coordArray = new Array();                      // line data array [pt0, pt1, pt2,...], eath point is pt0=[lon0,lat0]
        var lineColorRED = '#ff0000'; // red

        var lineVectorOLD = null;                             // vector layer variable
        var vectorSourceOLD = null;                           // variable for source
        var vectorFeatureOLD = null;                          // variable for feature
        var lineStringsOLD = new ol.geom.MultiLineString([]); // line instance of the path
        var lineStrArrayOLD = new Array();                    // line data array as lineString format [[pt0,pt1],[pt1,pt2],[pt2,pt3],....]
        var coordArrayOLD = new Array();                      // line data array [pt0, pt1, pt2,...], eath point is pt0=[lon0,lat0]
        var lineColorGREEN = '#00ff00'; // green

        var lineVectorPHONE0 = null;                             // vector layer variable
        var vectorSourcePHONE0 = null;                           // variable for source
        var vectorFeaturePHONE0 = null;                          // variable for feature
        var lineStringsPHONE0 = new ol.geom.MultiLineString([]); // line instance of the path
        var lineStrArrayPHONE0 = new Array();                    // line data array as lineString format [[pt0,pt1],[pt1,pt2],[pt2,pt3],....]

        var lineVectorPHONE1 = null;                             // vector layer variable
        var vectorSourcePHONE1 = null;                           // variable for source
        var vectorFeaturePHONE1 = null;                          // variable for feature
        var lineStringsPHONE1 = new ol.geom.MultiLineString([]); // line instance of the path
        var lineStrArrayPHONE1 = new Array();                    // line data array as lineString format [[pt0,pt1],[pt1,pt2],[pt2,pt3],....]

        var lineVectorPHONE2 = null;                             // vector layer variable
        var vectorSourcePHONE2 = null;                           // variable for source
        var vectorFeaturePHONE2 = null;                          // variable for feature
        var lineStringsPHONE2 = new ol.geom.MultiLineString([]); // line instance of the path
        var lineStrArrayPHONE2 = new Array();                    // line data array as lineString format [[pt0,pt1],[pt1,pt2],[pt2,pt3],....]

        var lineVectorPHONE3 = null;                             // vector layer variable
        var vectorSourcePHONE3 = null;                           // variable for source
        var vectorFeaturePHONE3 = null;                          // variable for feature
        var lineStringsPHONE3 = new ol.geom.MultiLineString([]); // line instance of the path
        var lineStrArrayPHONE3 = new Array();                    // line data array as lineString format [[pt0,pt1],[pt1,pt2],[pt2,pt3],....]

        var lineVectorPHONE4 = null;                             // vector layer variable
        var vectorSourcePHONE4 = null;                           // variable for source
        var vectorFeaturePHONE4 = null;                          // variable for feature
        var lineStringsPHONE4 = new ol.geom.MultiLineString([]); // line instance of the path
        var lineStrArrayPHONE4 = new Array();                    // line data array as lineString format [[pt0,pt1],[pt1,pt2],[pt2,pt3],....]

        var coordArrayPHONE = new Array();                      // line data array [pt0, pt1, pt2,...], eath point is pt0=[lon0,lat0]
//        var lineColorBLUE0 = '#800080'; // purple
        var lineColorBLUE0 = '#ff0000'; // red
        var lineColorBLUE1 = '#00ffff'; // cyan
        var lineColorBLUE2 = '#00ced1'; // darkturquoise
        var lineColorBLUE3 = '#008080'; // treal
        var lineColorBLUE4 = '#0000ff'; // blue

        var xydata = "0,138.949664,37.860869,138.949621,37.860813,138.949690,37.860781,138.949832,37.860814,138.949947,37.861063,138.949800,37.861253,138.949834,37.861267,138.949780,37.861284,138.949895,37.861311,138.949753,37.861403,138.949224,37.861873,138.948509,37.862516,138.947788,37.863168,138.947208,37.863719,138.947074,37.863907,138.947278,37.864063,138.947290,37.864062,138.947307,37.864062,138.947317,37.864068,138.947298,37.864066,138.947286,37.864101*4,4,4,4,3,4,4,3,4,4,4,4,4,3,3,3,2,2,2,3,2,2";

    function init_map(){
        view = new ol.View({ projection: "EPSG:3857",
            zoom: initZoom,
            maxZoom: MaxZoom,
            minZoom: MinZoom
        })

        // 地理院地図
        gsi_layer = new ol.layer.Tile({
            source: new ol.source.XYZ({
            attributions: [
                new ol.Attribution({
                html: "<a href='https://maps.gsi.go.jp/development/ichiran.html' target='_blank'>地理院地図</a>"
                })
            ],
            url: "https://cyberjapandata.gsi.go.jp/xyz/std/{z}/{x}/{y}.png",
            projection: "EPSG:3857"
            })
        });

    // 産総研地質図
        gsj_layer = new ol.layer.Tile({
            opacity: 0.7,
            source: new ol.source.XYZ({
            attributions: [
                new ol.Attribution({
                html: "<a href='https://gbank.gsj.jp/seamless/v2/api/1.2/legend.html' target='_blank'>産総研シームレス地質図</a>"
                })
            ],
            url: "https://gbank.gsj.jp/seamless/v2/api/1.2/tiles/{z}/{y}/{x}.png",
            projection: "EPSG:3857"
            })
        });

    // 傾斜図
        gsk_layer = new ol.layer.Tile({
            opacity: 0.6,
            source: new ol.source.XYZ({
            attributions: [
                new ol.Attribution({
                html: "<a href='https://maps.gsi.go.jp/development/ichiran.html' target='_blank'>地理院傾斜地図</a>"
                })
            ],
            url: "https://cyberjapandata.gsi.go.jp/xyz/slopemap/{z}/{x}/{y}.png",
            projection: "EPSG:3857"
            })
        });

    // Open Street Map
        osm_layer = new ol.layer.Tile({
            opacity: 0.6,
            source: new ol.source.OSM()
        });

        map = new ol.Map({
            layers: [gsi_layer],
            target: document.getElementById('map'),
            view: view,
            renderer: ['canvas', 'dom'],
            controls: ol.control.defaults().extend([new ol.control.ScaleLine()]),
            interactions: ol.interaction.defaults()
        });

        geomap_Setting();
        drawLine_phone(xydata);
    }
    function geomap_Setting(){
 
        // zoom slider の追加
//        map.addControl(new ol.control.ZoomSlider());
        // 中心の指定。view に対して指定。transform を忘れないこと。
        view.setCenter(ol.proj.transform([138.731388, 35.362222], "EPSG:4326", "EPSG:3857"));
        // zoom の指定。view に対して指定する。
        view.setZoom(initZoom);

    }

    function drawLine_phone(xy) {
    // 経路線用の vector データを作る
        var stData = xy.split("*");
        var zahyou = stData[0].split(",");
        var phoneStatus = stData[1].split(",");


        for ( var i = 0; i < Math.floor(zahyou.length/2); i++){
            coordArrayPHONE.push([parseFloat(zahyou[i*2+1]), parseFloat(zahyou[i*2+2])]);
        }
        if (coordArrayPHONE.length == 1){
            view.setCenter(ol.proj.transform([parseFloat(zahyou[1]), parseFloat(zahyou[2])], "EPSG:4326", "EPSG:3857"));
        }
        if (coordArrayPHONE.length > 1) {
            lineStrArrayPHONE0.length = 0;  // 経路線用の配列を一度クリア（これをしないと変に画像が残る
            lineStrArrayPHONE1.length = 0;  // 経路線用の配列を一度クリア（これをしないと変に画像が残る
            lineStrArrayPHONE2.length = 0;  // 経路線用の配列を一度クリア（これをしないと変に画像が残る
            lineStrArrayPHONE3.length = 0;  // 経路線用の配列を一度クリア（これをしないと変に画像が残る
            lineStrArrayPHONE4.length = 0;  // 経路線用の配列を一度クリア（これをしないと変に画像が残る
            for (i=0; i<(coordArrayPHONE.length-1); i++) {
                switch (phoneStatus[i+1]){
                case '0':
                    lineStrArrayPHONE0.push([coordArrayPHONE[i], coordArrayPHONE[i+1]]);
                    break;
                case '1':
                    lineStrArrayPHONE1.push([coordArrayPHONE[i], coordArrayPHONE[i+1]]);
                    break;
                case '2':
                    lineStrArrayPHONE2.push([coordArrayPHONE[i], coordArrayPHONE[i+1]]);
                    break;
                case '3':
                    lineStrArrayPHONE3.push([coordArrayPHONE[i], coordArrayPHONE[i+1]]);
                    break;
                case '4':
                    lineStrArrayPHONE4.push([coordArrayPHONE[i], coordArrayPHONE[i+1]]);
                    break;
                }
            }

            if (lineStrArrayPHONE0.length > 0){
                lineStringsPHONE0.setCoordinates(lineStrArrayPHONE0);
                vectorFeaturePHONE0 = new ol.Feature(lineStringsPHONE0.transform('EPSG:4326', 'EPSG:3857'));

                vectorSourcePHONE0  = new ol.source.Vector({ features: [vectorFeaturePHONE0] }); // vector layer 用のソースの作成
                // 経路用の vector layer の作成
                lineVectorPHONE0 = new ol.layer.Vector({
                    source: vectorSourcePHONE0,
                    style: new ol.style.Style({
                        stroke: new ol.style.Stroke({ color: lineColorBLUE0, width: 4 })
                    })
                });
                // vector layer の追加
                map.addLayer(lineVectorPHONE0);
            }

            if (lineStrArrayPHONE1.length > 0){
                lineStringsPHONE1.setCoordinates(lineStrArrayPHONE1);
                vectorFeaturePHONE1 = new ol.Feature(lineStringsPHONE1.transform('EPSG:4326', 'EPSG:3857'));

                vectorSourcePHONE1  = new ol.source.Vector({ features: [vectorFeaturePHONE1] }); // vector layer 用のソースの作成
                // 経路用の vector layer の作成
                lineVectorPHONE1 = new ol.layer.Vector({
                    source: vectorSourcePHONE1,
                    style: new ol.style.Style({
                        stroke: new ol.style.Stroke({ color: lineColorBLUE1, width: 4 })
                    })
                });
                // vector layer の追加
                map.addLayer(lineVectorPHONE1);
            }

            if (lineStrArrayPHONE2.length > 0){
                lineStringsPHONE2.setCoordinates(lineStrArrayPHONE2);
                vectorFeaturePHONE2 = new ol.Feature(lineStringsPHONE2.transform('EPSG:4326', 'EPSG:3857'));

                vectorSourcePHONE2  = new ol.source.Vector({ features: [vectorFeaturePHONE2] }); // vector layer 用のソースの作成
                // 経路用の vector layer の作成
                lineVectorPHONE2 = new ol.layer.Vector({
                    source: vectorSourcePHONE2,
                    style: new ol.style.Style({
                        stroke: new ol.style.Stroke({ color: lineColorBLUE2, width: 6 })
                    })
                });
                // vector layer の追加
                map.addLayer(lineVectorPHONE2);
            }

            if (lineStrArrayPHONE3.length > 0){
                lineStringsPHONE3.setCoordinates(lineStrArrayPHONE3);
                vectorFeaturePHONE3 = new ol.Feature(lineStringsPHONE3.transform('EPSG:4326', 'EPSG:3857'));

                vectorSourcePHONE3  = new ol.source.Vector({ features: [vectorFeaturePHONE3] }); // vector layer 用のソースの作成
                // 経路用の vector layer の作成
                lineVectorPHONE3 = new ol.layer.Vector({
                    source: vectorSourcePHONE3,
                    style: new ol.style.Style({
                        stroke: new ol.style.Stroke({ color: lineColorBLUE3, width: 8 })
                    })
                });
                // vector layer の追加
                map.addLayer(lineVectorPHONE3);
            }

            if (lineStrArrayPHONE4.length > 0){
                lineStringsPHONE4.setCoordinates(lineStrArrayPHONE4);
                vectorFeaturePHONE4 = new ol.Feature(lineStringsPHONE4.transform('EPSG:4326', 'EPSG:3857'));

                vectorSourcePHONE4  = new ol.source.Vector({ features: [vectorFeaturePHONE4] }); // vector layer 用のソースの作成
                // 経路用の vector layer の作成
                lineVectorPHONE4 = new ol.layer.Vector({
                    source: vectorSourcePHONE4,
                    style: new ol.style.Style({
                        stroke: new ol.style.Stroke({ color: lineColorBLUE4, width: 10 })
                    })
                });
                // vector layer の追加
                map.addLayer(lineVectorPHONE4);
            }

        }
    }


</script>
</body>
</html>
